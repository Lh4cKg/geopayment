### Documentation for using TBCPay module
There are two types of transaction within this system: SMS and DMS.

SMS - is a direct payment method, money is charged in 1 event, as soon as customer enters the credit card details and clicks proceed.

DMS - is a two step method, first event blocks the money on the card (max 30 days), second event captures the money (second event can be carried out when product is shipped to the customer for example).

Every 24 hours, a merchant must close the business day.

##### Generate Certificate from p12
`p12_to_pem` function return certificate from p12 as pem format. returned certificate
contains cert and cert-key.

```python
from geopayment.crypto import p12_to_pem

cert = '/absolute/path/my_cert.p12'
p12_to_pem(cert=cert, password='cert-pass', file_name='out-cert-name', output='/absolute/output/path/')
# result
'out-cert-name.pem'
'out-cert-name-key.pem'
```

##### Initialize Provider Object
```python
from geopayment import TBCProvider

class MyTBCProvider(TBCProvider):

    @property
    def description(self) -> str:
        """default description"""
        return 'mybrand description'

    @property
    def client_ip(self) -> str:
        return 'xx.xx.xx.xx'

    @property
    def service_url(self) -> str:
        return 'https://ecommerce.ufc.ge:18443/ecomm2/MerchantHandler'

    @property
    def cert(self):
        return (
            '/absolute/output/path/out-cert-name.pem',
            '/absolute/output/path/out-cert-name-key.pem'         
        )

```

Consider the first type of authorization (SMS authorization)

1. Generate transaction id

    Function name: `get_trans_id`
    
    input: 
    
        amount: float, int, deciaml (required)
        currency: int, str (required)
        client_ip_addr: str (optional)
        description: str (optional)
        language: str (optional)
    
   ```python
    provider = MyTBCProvider()
    result = provider.get_trans_id(amount=23.50, currency='GEL')
    print(result)
    {'TRANSACTION_ID': 'NMQfTRLUTne3eywr9YnAU78Qxxw='}
    print(provider.trans_id)
    NMQfTRLUTne3eywr9YnAU78Qxxw=
    ```

2. Check transaction status

    Function name: `check_trans_status`
    
    input:
    
        trans_id: str (required) 
        client_ip_addr: str (optional)
    
    
   ```python
    provider = MyTBCProvider()
    result = provider.check_trans_status(trans_id=provider.trans_id)
    print(result)
    {'RESULT': 'OK', 'RESULT_CODE': '000', '3DSECURE': 'ATTEMPTED',
    'CARD_NUMBER': '', 'RRN': '', 'APPROVAL_CODE': ''}
   ```

Consider the type of DMS authorization

1. Generate transaction id with DMS authorization

    Function name: `pre_auth_trans`
  
    input:
    
        amount: float, int, decimal (required)
        currency: int, str (required)
        client_ip_addr: str (optional)
        description: str (optional)
        language: str (optional)
    
    ```python
    provider = MyTBCProvider()
    result = provider.pre_auth_trans(amount=43.20, currency=981)
    print(result)
    {'TRANSACTION_ID': 'NMQfTRLUTne3eywr9YnAU78Qxxw='}
    print(provider.trans_id)
    NMQfTRLUTne3eywr9YnAU78Qxxw=
    ```
2. Commit a transaction generated by DMS authorization

    Function name: `confirm_pre_auth_trans`
    
    input:
    
        trans_id: str (required)
        amount: float, int, decimal (required)
        currency: int, str (required)
        client_ip_addr: str (optional)
        description: str (optional)
        language: str (optional)
        
    ```python
    provider = MyTBCProvider()
    result = provider.confirm_pre_auth_trans(trans_id=provider.trans_id, amount=43.20, currency=981)
    print(result)
    {'RESULT': 'OK', 'RESULT_CODE': '', 'BRN': '' 'APPROVAL_CODE': '', 'CARD_NUMBER': ''}
    ```
   
Consider other operations, e.g. Reversal, Refund, Card Register with deduction, 
Card Register with Zero Auth, Recurring Payment, Refund To Debit Card, End of Business Day

1. End of Business Day

    Function name: `end_of_business_day`
    ```python
    provider = MyTBCProvider()
    result = provider.end_of_business_day()
    print(result)
    ```
   
2. Transaction reversal
    
    Function name: `reversal_trans`
    
    input:
    
        trans_id: str (required)
        amount: float, int, decimal (required)
        
    ```python
    provider = MyTBCProvider()
    provider.reversal_trans(trans_id=provider.trans_id, amount=12.20)
    {'RESULT': 'OK', 'RESULT_CODE': ''}
    ```

3. Transaction refund

    Function name: `refund_trans`
    
    input:
    
        trans_id: str (required)
        amount: float, int, decimal (required)
        
    ```python
    provider = MyTBCProvider()
    provider.refund_trans(trans_id=provider.trans_id, amount=12.20)
    {'RESULT': '', 'RESULT_CODE': '', 'REFUND_TRANS_ID': ''}
    ```

4. Card Register with deduction

    Function name: `card_register_with_deduction`
    
    input:
        
        amount: float, int, decimal (required)
        currency: int, str (required)
        biller_client_id: str (required)
        expiry: str (required)
        perspayee_expiry: str (required)
        perspayee_gen: int, str (required)
        
    ```python
    provider = MyTBCProvider()
    provider.card_register_with_deduction(amount=12.20, currency='GEL', biller_client_id='GEOpayMENTs', expiry='1125', perspayee_expiry='1125', perspayee_gen=1)
    {'RESULT': '', 'RESULT_CODE': '', 'TRANSACTION_ID': ''}
    ```

5. Card Register with Zero Auth

    Function name: `card_register_with_zero_auth`
    
    input:
        
        currency: int, str (required)
        biller_client_id: str (required)
        expiry: str (required)
        perspayee_expiry: str (required)
        perspayee_gen: int, str (required)
        
    ```python
    provider = MyTBCProvider()
    provider.card_register_with_zero_auth(currency='GEL', biller_client_id='GEOpayMENTs', expiry='1125', perspayee_expiry='1125', perspayee_gen=1)
    {'RESULT': '', 'RESULT_CODE': '', 'TRANSACTION_ID': ''}
    ```

6. Recurring Payment

    Function name: `recurring_payment`
    
    input:
        
        amount: float, int, decimal (required)
        currency: int, str (required)
        biller_client_id: str (required)
        
    ```python
    provider = MyTBCProvider()
    provider.recurring_payment(amount=12.20, currency='GEL', biller_client_id='GEOpayMENTs')
    {'RESULT': '', 'RESULT_CODE': '', 'TRANSACTION_ID': '', 'RRN': '', 'APPROVAL_CODE': ''}
    ```

7. Refund to Debit Card

    Function name: `refund_to_debit_card`
    
    input:
    
        trans_id: str (required)
        amount: float, int, decimal (required)
        
    ```python
    provider = MyTBCProvider()
    trans_id = 'NMQfTRLUTne3eywr9YnAU78Qxxw='
    provider.refund_to_debit_card(trans_id=trans_id, amount=12.20)
    {'RESULT': '', 'RESULT_CODE': '', 'REFUND_TRANS_ID': ''}
    ```

### Description of the parameters used

   1. amount           - Amount to be paid. (float, int, deciaml, 12 characters)
   2. currency         - Transaction currency. (int 3 digits - Num ISO 4217 standard or str 3 characters - Code ISO 4217 standard)
   3. client_ip_addr   - Client ip address. (str, 15 characters)
   4. description      - Description of the transaction. (str, 125 ASCII characters)
   5. language         - Payment page language. (str, 2 characters)
   6. trans_id         - Encrypted transaction identifier, obtained from operations performed.
   7. biller_client_id - Regular payment identifier generated by the merchant for each card. (str, 49 ASCII characters)
   8. expiry           - Regular payment expiration date. (str, MMYY format)
   9. perspayee_expiry - (str, MMYY format)
   10. perspayee_gen    - (int, ?)
   
